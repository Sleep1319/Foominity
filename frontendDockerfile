FROM node:20-alpine AS build
WORKDIR /app
COPY package*.json ./
RUN npm ci --legacy-peer-deps
COPY . .

ARG VITE_API_URL
ARG VITE_RAPIDAPI_HOST
ARG VITE_RAPIDAPI_KEY
ENV VITE_API_URL=$VITE_API_URL
ENV VITE_RAPIDAPI_HOST=$VITE_RAPIDAPI_HOST
ENV VITE_RAPIDAPI_KEY=$VITE_RAPIDAPI_KEY

RUN npm run build

FROM node:20-alpine
WORKDIR /app
RUN npm i -g http-server
COPY --from=build /app/dist ./dist
EXPOSE 5173
CMD ["http-server","dist","-p","5173"]